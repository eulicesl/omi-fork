; PlatformIO build for Seeed XIAO ESP32‑S3 Sense (camera + PDM mic)
; Adds OPUS audio over BLE and produces a UF2 for drag‑and‑drop.

[env:seeed_xiao_esp32s3]
platform        = espressif32@6.5.0
board           = xiao_esp32s3
framework       = arduino
monitor_speed   = 115200
upload_protocol = esptool

; PSRAM & camera support
build_flags =
  -DARDUINO_USB_MODE=1
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DBOARD_HAS_PSRAM
  -mfix-esp32-psram-cache-issue

; External libs (BLEDevice & esp_camera are part of the ESP32 core)
lib_deps =
  pschatzmann/arduino-libopus @ ^0.2.3
  pschatzmann/arduino-audio-tools @ ^1.0.12

; Post‑build: convert .bin → .uf2
extra_scripts = post:scripts/make_uf2.py

[env:uf2_release]
extends     = env:seeed_xiao_esp32s3
build_type  = release
